# 多功能AI聊天助手

一个功能丰富、界面美观的AI聊天助手，支持多种AI平台集成，具有网络安全管理、记忆模块、任务管理、数据库同步等功能。

## 🌟 功能特点

### 核心功能
- **多平台支持**：兼容多种AI平台API，如心流AI、OpenAI等
- **美观界面**：支持多种主题切换（默认主题、深色主题、浅色主题）
- **启动动画**：优雅的启动界面和进度显示
- **流式输出**：支持AI响应的流式显示，提升交互体验
- **对话管理**：支持对话历史的保存、导入和导出
- **模块化设计**：清晰的代码结构，便于维护和扩展
- **异步优化**：采用异步文件I/O和网络请求，提升程序响应速度
- **数据库同步**：支持将对话历史和配置同步到远程数据库（MySQL、PostgreSQL、SQLite）
- **统计报告**：生成聊天统计数据和图表，支持导出统计报告
- **系统监控**：实时监控网络状态、数据库状态和系统资源
  - 网络状态：连接状态、IP地址、延迟和网速
  - 数据库状态：连接状态、同步状态和数据库类型
  - 系统资源：内存使用情况
- **智能缓存**：优化的网络请求、IP地址和主题样式缓存机制
- **响应速度控制**：可调整AI响应的显示速度
- **时间戳显示**：可配置是否显示消息时间戳
- **消息方向**：所有消息从左向右显示，保持一致的视觉风格

### 任务管理
- **待办事项管理**：支持添加、完成和删除任务，包含任务ID、优先级和完成时间戳
- **日历事件创建**：支持创建和管理日历事件，包含标题、日期、时间和描述
- **笔记应用集成**：支持创建、更新和删除笔记，包含标题、内容和时间戳

### 安全增强
- **API密钥加密**：使用Fernet对称加密算法安全存储API密钥
- **数据库凭据加密**：加密存储数据库用户名和密码，防止泄露
- **端到端加密支持**：增强的加密管理器，支持对称和非对称加密
- **密钥导出/导入**：支持端到端加密密钥的安全导出和导入
- **域名白名单/黑名单**：可自定义允许访问的域名
- **IP白名单/黑名单**：可自定义允许访问的IP地址
- **SSL验证**：可配置是否启用SSL证书验证
- **安全日志**：记录所有网络请求的安全状态
- **文件权限管理**：确保敏感文件只有所有者可访问

### 日志与审计
- **详细的用户活动日志**：记录用户操作和系统事件
- **操作审计功能**：详细的操作记录，包括操作类型、用户和成功状态
- **日志导出和分析**：支持多种格式日志导出和详细的日志统计分析
- **日志轮转**：自动处理大日志文件，防止磁盘空间耗尽
- **多级别日志**：支持DEBUG、INFO、WARNING、ERROR四个日志级别

### 记忆模块
- **个人信息管理**：可保存和管理个人信息
- **任务记录管理**：支持添加、编辑、删除、归档任务
- **记忆导出/导入**：支持记忆数据的备份和恢复
- **对话记忆**：自动保存对话历史到记忆文件夹
- **记忆设置**：可配置记忆长度、令牌数、保留天数等

### 网络监控
- **网络状态检测**：实时监控网络连接状态
- **IP地址显示**：显示本地IP地址
- **Ping延迟检测**：测试网络延迟
- **上传下载速度监控**：实时显示网络速度

### 调试功能
- **详细日志**：记录应用程序运行状态
- **调试模式**：可开启/关闭调试信息
- **API状态跟踪**：记录所有API请求的状态和响应时间
- **日志导出**：支持日志的复制和清空
- **JSON格式请求**：显示原始JSON格式的请求信息

### 记忆模块
- **个人信息管理**：可保存和管理个人信息
- **任务记录管理**：支持添加、编辑、删除、归档任务
- **记忆导出/导入**：支持记忆数据的备份和恢复
- **对话记忆**：自动保存对话历史到记忆文件夹
- **记忆设置**：可配置记忆长度、令牌数、保留天数等

### 网络监控
- **网络状态检测**：实时监控网络连接状态
- **IP地址显示**：显示本地IP地址
- **Ping延迟检测**：测试网络延迟
- **上传下载速度监控**：实时显示网络速度

### 调试功能
- **详细日志**：记录应用程序运行状态
- **调试模式**：可开启/关闭调试信息
- **API状态跟踪**：记录所有API请求的状态和响应时间
- **日志导出**：支持日志的复制和清空
- **JSON格式请求**：显示原始JSON格式的请求信息

### 数据库功能
- **多数据库支持**：兼容MySQL、PostgreSQL、SQLite
- **数据库优化**：添加索引和批量操作，提升查询性能
- **手动同步**：支持手动测试连接和上传数据
- **自动同步**：可配置启动时同步和定时同步
- **同步配置**：可选择同步配置、对话历史、记忆数据等
- **同步控制**：支持暂停/恢复自动同步

### UI改进
- **消息气泡设计**：现代化的消息气泡样式，区分用户和AI消息
- **自动调整输入框**：输入框高度随内容自动调整
- **平台配置管理**：支持在软件内自定义配置AI平台和模型参数
- **响应式布局**：优化的界面布局，提升用户体验

### 统计功能
- **对话统计**：总对话次数、总消息数量、平均响应时间等
- **图表可视化**：使用PyQtGraph创建统计图表
- **响应时间分布**：分析AI响应时间分布
- **报告导出**：支持导出统计报告为JSON或CSV格式

## 📋 系统要求

- Python 3.8+
- Windows、macOS、Linux

## 🚀 快速开始

### 安装依赖

```bash
pip install -r requirements.txt
```

### 运行程序

#### GUI版本（推荐）
```bash
python main.py
```
或
```bash
python universal_chatbot_pyqt6.py
```

#### 命令行版本

```bash
python cli_chatbot.py
```

## 🛠️ 配置说明

### 配置文件

程序启动后会在软件所在目录生成`chatbot_config.json`配置文件，包含以下主要配置项：

```json
{
  "platforms": {
    "iflow": {
      "name": "心流AI",
      "api_key": "your_api_key",
      "api_base": "https://apis.iflow.cn/v1",
      "models": ["gpt-4o", "gpt-4-turbo"],
      "enabled": true
    }
  },
  "settings": {
    "window": {
      "width": 1200,
      "height": 800,
      "auto_save": true
    },
    "appearance": {
      "theme": "默认主题",
      "font": null,
      "font_size": 12
    },
    "network": {
      "timeout": 30,
      "retry_count": 1,
      "use_proxy": false,
      "proxy_type": "HTTP",
      "proxy_host": "",
      "proxy_port": 8080,
      "verify_ssl": false
    },
    "chat": {
      "auto_scroll": true,
      "auto_save": true,
      "show_timestamp": true,
      "streaming": true,
      "response_speed": 5,
      "max_history": 100
    },
    "memory": {
      "enabled": true,
      "memory_type": "short_term",
      "max_memory_length": 10,
      "max_tokens": 8192,
      "memory_persistence": true,
      "memory_retention_days": 7
    },
    "database": {
      "enabled": false,
      "type": "mysql",
      "host": "localhost",
      "port": 3306,
      "database": "chatbot",
      "username": "root",
      "password": "",
      "sync_on_startup": true,
      "sync_interval": 300,
      "sync_config": true,
      "sync_conversations": true,
      "sync_memories": true
    }
  }
}
```

### 平台配置

首次运行时，程序会使用默认配置（心流AI）。你可以通过界面上的"设置"按钮来管理AI平台配置。

每个平台配置包含：
- **平台名称**：自定义平台名称
- **API密钥**：平台的API密钥
- **API地址**：平台的API Base URL
- **模型列表**：平台支持的模型名称
- **启用状态**：是否启用该平台

## 📱 界面说明

### 左侧面板
- **配置设置**：选择AI平台、API地址、API密钥、模型
- **调试控制**：启用/关闭调试模式、自动滚动、自动保存等
- **调试信息**：显示程序运行日志和网络状态

### 右侧面板
- **对话标签**：显示与AI的对话内容
- **搜索结果标签**：显示联网搜索结果
- **输入区域**：输入聊天内容（已加大尺寸）

### 菜单栏
- **文件**：导出/导入对话历史、记忆管理
- **设置**：综合设置对话框，包含所有配置选项
- **统计**：查看聊天统计报告
- **帮助**：关于和使用帮助

## 🔧 高级功能

### 自定义主题

程序支持三种主题：
- `默认主题`：系统默认主题
- `深色主题`：深色模式
- `浅色主题`：浅色模式

可通过设置菜单或配置文件修改主题。

### 聊天设置

可配置聊天相关参数：
- **自动滚动**：是否自动滚动到最新消息
- **自动保存**：是否自动保存对话历史
- **显示时间戳**：是否在消息中显示时间
- **流式输出**：是否启用AI响应的流式显示
- **响应速度**：调整AI响应的显示速度（1-10）
- **最大历史记录**：设置保存的最大对话历史条数

### 记忆设置

可配置记忆相关参数：
- **记忆类型**：short_term（短期记忆）、long_term（长期记忆）、none（无记忆）
- **最大记忆长度**：1-100条
- **最大令牌数**：1024-32768令牌
- **记忆持久化**：是否持久化保存记忆
- **记忆保留天数**：1-365天

### 网络设置

可配置网络相关参数：
- **超时时间**：网络请求超时时间（秒）
- **重试次数**：请求失败后的重试次数
- **代理设置**：支持HTTP代理配置
- **SSL验证**：是否启用SSL证书验证

### 数据库同步

支持以下数据库同步功能：
- **连接测试**：手动测试数据库连接
- **手动上传**：手动上传数据到数据库
- **启动同步**：启动时自动同步数据
- **定时同步**：可配置同步间隔（60-3600秒）
- **选择性同步**：可选择同步配置、对话历史、记忆数据

### 统计报告

统计报告包含：
- **统计概览**：总对话次数、总消息数量等
- **统计图表**：显示消息数量和响应时间趋势
- **响应时间分布**：分析AI响应时间分布
- **报告导出**：支持导出为JSON或CSV格式

## 📁 文件结构

```
probable-fishstick/
├── main.py  # 主入口文件
├── cli_chatbot.py  # 命令行版本
├── README.md  # 说明文档
├── requirements.txt  # 依赖列表
├── chatbot_config.json  # 配置文件
├── conversation_history.json  # 对话历史文件
├── encryption_key.key  # 加密密钥文件
├── logs/  # 日志文件保存目录
│   ├── activity.log  # 用户活动日志
│   ├── audit.log  # 操作审计日志
│   └── error.log  # 错误日志
├── memories/  # 记忆数据保存目录
│   ├── personal_info.json  # 个人信息
│   ├── task_records.json  # 任务记录
│   ├── calendar_events.json  # 日历事件
│   └── notes.json  # 笔记数据
├── src/  # 核心模块目录
│   ├── api/  # API相关模块
│   │   └── api_handler.py  # API请求处理
│   ├── core/  # 核心功能模块
│   │   ├── chat_core.py  # 聊天核心逻辑
│   │   └── theme_manager.py  # 主题管理
│   ├── data/  # 数据处理模块
│   │   ├── config.py  # 配置管理
│   │   ├── database.py  # 数据库操作
│   │   ├── memory.py  # 记忆管理
│   │   ├── settings.py  # 设置管理
│   │   └── statistics.py  # 统计功能
│   ├── network/  # 网络相关模块
│   │   ├── network_manager.py  # 网络管理
│   │   └── security.py  # 网络安全
│   ├── ui/  # UI界面模块
│   │   ├── ui_manager.py  # UI管理
│   │   └── dialogs.py  # 对话框组件
│   └── utils/  # 工具函数模块
│       ├── async_helpers.py  # 异步操作工具
│       ├── cache_manager.py  # 智能缓存管理
│       ├── encryption.py  # 加密工具
│       ├── helpers.py  # 通用工具函数
│       ├── logging_manager.py  # 日志管理
│       └── network.py  # 网络监控
└── tests/  # 测试用例目录
    ├── test_encryption.py  # 加密功能测试
    ├── test_async_helpers.py  # 异步工具测试
    ├── test_cache_manager.py  # 缓存管理测试
    └── test_settings.py  # 设置管理测试
```

## 🔒 安全注意事项

- **API密钥保护**：API密钥使用Fernet对称加密算法存储，加密密钥保存在`encryption_key.key`文件中
- **数据库凭据加密**：数据库用户名和密码自动加密存储，防止明文泄露
- **文件权限**：敏感文件（如加密密钥、配置文件）设置了严格的文件权限，只有所有者可访问
- 请勿将包含加密密钥的`encryption_key.key`文件分享给他人
- 建议定期备份对话历史和记忆数据
- 启用SSL验证以提高网络安全性
- 定期检查安全日志，确保没有可疑的网络请求
- 定期更新依赖包，修复已知安全漏洞
- 数据库密码请使用强密码，并定期更换

## 📝 更新日志

### 最新更新
- **系统监控面板**：添加了完整的系统监控功能，包括网络状态、数据库状态和系统资源监控
  - 网络状态：实时显示连接状态、IP地址和延迟
  - 数据库状态：显示连接状态、同步状态和数据库类型
  - 系统资源：实时显示内存使用情况
- **端到端加密支持**：增强的加密管理器，支持对称和非对称加密、密钥生成和导出/导入
- **完整的日志与审计系统**：实现了详细的用户活动日志、操作审计和日志导出/分析功能
  - 多级日志管理（DEBUG、INFO、WARNING、ERROR）
  - 自动日志轮转，防止磁盘空间耗尽
  - 支持多种格式日志导出
  - 详细的日志统计分析
- **任务管理增强**：
  - 待办事项管理：支持添加、完成和删除任务，包含任务ID、优先级和完成时间戳
  - 日历事件创建：支持创建和管理日历事件
  - 笔记应用集成：支持创建、更新和删除笔记
- **智能缓存策略**：优化的缓存管理器，支持对话历史和主题样式的智能缓存
  - 可配置的缓存大小限制
  - 自动缓存清理机制
  - 缓存过期时间管理
- **消息方向优化**：所有消息从左向右显示，保持一致的视觉风格
- **性能优化**：
  - 批量HTML构建，减少UI更新次数，提升大量消息加载速度
  - 优化的内存使用策略
  - 异步文件I/O和网络请求
- **代码结构优化**：进一步优化模块化设计，清晰的功能划分
- **错误处理增强**：添加了更全面的错误处理和异常捕获
- **修复了系统监控数据更新错误**：解决了'bool' object is not callable异常
- **修复了主题缓存问题**：优化了主题样式的缓存机制
- **修复了消息显示样式问题**：统一了消息气泡的显示方向

### 之前更新
- **模块化重构**：将代码重构为模块化结构，核心功能拆分到src目录
- **新增主入口文件**：添加了main.py作为程序主入口，包含启动动画
- **优化的启动流程**：添加了优雅的启动动画和进度显示
- **改进的对话历史管理**：优化了对话历史的存储和加载机制
- 添加了数据库同步功能，支持MySQL、PostgreSQL、SQLite
- 实现了统计报告功能，包含图表可视化
- 优化了对话输入框，增大了尺寸
- 添加了JSON格式请求显示
- 实现了手动测试和上传数据库按钮
- 修复了AI响应空白的问题
- 优化了记忆设置模块
- 添加了命令行版本
- 修复了统计图表的轴添加错误
- 修复了对话历史上传问题
- 实现了完整的个人信息对话框
- 实现了完整的任务管理对话框
- 修复了数据库同步时的主键冲突问题
- 改进了ID生成逻辑，使用UUID确保唯一性
- 修复了任务管理中的类型错误
- 优化了数据库同步逻辑，使用INSERT ... ON DUPLICATE KEY UPDATE
- 增强了网络安全功能，支持域名/IP黑白名单
- 改进了设置选项的响应速度
- 修复了多个稳定性问题

### 之前更新
- 优化了网络监控功能，减少CPU占用
- 改进了记忆模块，支持更多自定义字段
- 增强了安全管理功能，支持更细粒度的访问控制
- 优化了界面布局，提升用户体验
- 修复了一些已知问题

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 📄 许可证

MIT License

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者！
