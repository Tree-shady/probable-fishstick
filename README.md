# AI对话软件

## 项目介绍

AI对话软件是一个功能强大、灵活易用的Python对话工具，支持多种大模型API服务。该软件提供命令行和图形界面两种交互方式，可根据用户需求自由切换，并具备丰富的高级功能。

### 设计理念

- **灵活性**：支持自定义API URL、API密钥和模型，兼容多种大模型服务
- **易用性**：提供直观的界面和清晰的操作流程
- **可靠性**：完善的错误处理和详细的错误提示
- **可扩展性**：模块化设计，便于添加新功能和支持更多API格式
- **智能性**：支持角色预设、情绪模拟、风格模仿等高级功能
- **可视化**：提供实时思维可视化，增强用户体验

### 核心优势

- 支持多种API响应格式，无需修改代码即可切换不同大模型服务
- 提供详细的错误信息，便于调试和问题排查
- 支持对话历史记录，保持上下文连贯
- 跨平台兼容，可在Windows、macOS和Linux上运行
- 开源免费，可自由修改和扩展
- 丰富的高级功能，提升用户体验
- 实时思维可视化，增强对话理解

## 功能特点

### 基础功能
- ✅ 支持自定义API URL
- ✅ 支持自定义API密钥
- ✅ 支持自定义模型名称
- ✅ 支持调整temperature和max_tokens参数
- ✅ 对话历史记录
- ✅ 命令行界面，简单易用
- ✅ 图形界面（GUI），可视化操作
- ✅ 启动动画效果
- ✅ 配置自动保存
- ✅ 消息时间戳和彩色显示
- ✅ 异步API调用，不阻塞界面
- ✅ 支持多种API响应格式
- ✅ 详细的错误信息提示
- ✅ 支持iflow.cn平台API
- ✅ 支持OpenAI API兼容接口
- ✅ 控制台调试输出

### 高级功能
- ✅ 角色预设功能（专业文案写手、严格的教育家、风趣的聊天伙伴、编程老师、商业顾问）
- ✅ 动态人格与情绪模拟（中性、兴奋、同情、好奇、幽默）
- ✅ 风格模仿功能，可以模仿指定文本的风格
- ✅ 反馈学习功能，支持赞/踩按钮和反馈收集
- ✅ 审计日志功能，记录所有用户操作
- ✅ 左侧调试信息显示，便于调试API调用

### 新增功能
- ✅ API模型切换功能，支持保存多个API服务商配置
- ✅ 消息复制功能，方便分享对话内容
- ✅ 对话导出功能，支持Markdown和TXT格式
- ✅ 全面的键盘快捷键支持，提高操作效率
- ✅ 消息搜索功能，快速定位对话内容
- ✅ 字体大小调整功能，提升阅读舒适度
- ✅ 左侧模型信息显示，清晰查看当前模型配置

## 技术栈

- **开发语言**：Python 3.7+
- **依赖库**：
  - requests：用于HTTP请求
  - PyQt6：用于图形界面
  - pyqtgraph：用于图形可视化
  - networkx：用于图论算法
  - numpy：用于数值计算
  - colorama：用于终端颜色输出

## 安装依赖

1. 确保已安装Python 3.7或更高版本
   - 可以从[Python官方网站](https://www.python.org/)下载并安装
   - 安装完成后，在命令行中运行`python --version`或`python3 --version`验证安装

2. 克隆或下载项目代码
   - 直接下载：点击GitHub页面的"Code"按钮，选择"Download ZIP"
   - 克隆代码：`git clone https://github.com/Tree-shady/probable-fishstick.git`

3. 进入项目目录
   ```bash
   cd probable-fishstick
   ```

4. 安装所需依赖：
   ```bash
   pip install -r requirements.txt
   ```
   - 如果使用Python 3.8+，可以使用以下命令：
     ```bash
     python -m pip install -r requirements.txt
     ```
   - 如果遇到权限问题，可以使用`--user`选项：
     ```bash
     pip install --user -r requirements.txt
     ```

## 运行程序

### 主入口文件（推荐）

```bash
python main.py
```

### 命令行版本

```bash
python ai_chat_cli.py
```

### PyQt图形界面版本

```bash
python ai_chat_pyqt.py
```

## 使用说明

### 命令行版本使用

#### 初始配置

首次运行程序时，会提示你配置API信息。你可以使用`/config`命令来更新配置：

```
你: /config
```

配置选项包括：
- `api_url`: API地址，例如 `https://api.openai.com/v1/chat/completions`
- `api_key`: 你的API密钥
- `model`: 模型名称，例如 `gpt-3.5-turbo`
- `temperature`: 温度参数，影响回复的随机性（0.0-2.0）
- `max_tokens`: 最大生成 tokens 数

#### 对话命令

- `/config`: 更新API配置
- `/clear`: 清空对话历史
- `/help`: 显示帮助信息
- `/exit`: 退出程序

### 图形界面（GUI）版本使用

#### 初始配置

1. 运行GUI版本后，会显示启动动画
2. 如果API密钥未配置，会提示是否立即配置
3. 你也可以通过菜单 "文件" -> "配置" 随时更新配置

#### 基本操作

- **发送消息**: 在输入框中输入消息，按 `Enter` 发送
- **换行**: 按 `Shift+Enter` 可以在输入框中换行
- **清空历史**: 点击 "清空" 按钮或通过菜单 "文件" -> "清空历史"
- **查看帮助**: 菜单 "帮助" -> "帮助"
- **查看关于**: 菜单 "帮助" -> "关于"

#### 界面布局

- **左侧**: 调试信息区域，显示API请求和响应的详细信息
- **右侧上部分**: 对话历史区域，显示用户和AI的对话内容
- **右侧下部分**: 思维可视化区域，实时生成对话思维导图
- **底部**: 输入区域，包含发送按钮、重新生成按钮、赞/踩按钮、清空按钮和新对话按钮

#### 角色预设使用

1. 点击菜单 "预设" -> "角色预设"
2. 选择一个角色，如"专业文案写手"、"严格的教育家"等
3. 系统会自动切换到该角色，并清空当前对话历史
4. 开始与AI进行对话，AI会按照所选角色的风格进行回复

#### 情绪选择使用

1. 点击菜单 "预设" -> "情绪选择"
2. 选择一种情绪，如"兴奋"、"同情"、"好奇"等
3. 系统会更新当前情绪，并调整AI的回答语气和风格
4. 情绪修改会立即生效，不需要清空对话历史

#### 风格模仿使用

1. 点击菜单 "预设" -> "风格模仿"
2. 在弹出的对话框中输入要模仿的文本
3. 点击"确定"，系统会将风格模仿提示添加到系统消息中
4. 开始与AI进行对话，AI会模仿你提供的文本风格进行回复

#### 反馈学习使用

1. 当收到AI回复后，赞/踩按钮会启用
2. 点击👍表示满意，点击👎表示不满意
3. 如果点击👎，系统会询问你哪里不好，你可以输入反馈
4. 系统会根据你的反馈调整后续回答

#### 思维可视化

1. 思维可视化区域位于右侧下部分，自动生成
2. 当收到AI响应时，自动更新思维导图
3. 当重新生成回答时，自动更新思维导图
4. 当清空历史时，自动更新思维导图
5. 当开始新对话时，自动更新思维导图
6. 思维导图以层级结构显示，用户消息为一级节点，AI回复为二级节点

## 对话示例

```
[2025-12-04 23:00:00] 你:
你好

[2025-12-04 23:00:01] AI:
你好！有什么可以帮助你的吗？

[2025-12-04 23:00:05] 你:
什么是人工智能？

[2025-12-04 23:00:06] AI:
人工智能（Artificial Intelligence，简称AI）是计算机科学的一个分支，它旨在创建能够模拟人类智能的系统...
```

## 支持的API格式

该软件支持多种API响应格式，包括：

### 1. OpenAI API兼容格式

支持与OpenAI API兼容的聊天接口，包括但不限于：
- OpenAI GPT系列（GPT-3.5, GPT-4等）
- DeepSeek
- Claude（通过兼容接口）
- 百度文心一言（通过OpenAI兼容接口）
- 阿里云通义千问（通过OpenAI兼容接口）
- 其他遵循OpenAI API格式的大模型服务

### 2. iflow.cn平台格式

专门支持iflow.cn平台的API响应格式，包括：
- 成功响应：包含`status`、`msg`和`body`字段
- 错误响应：从`msg`字段提取详细错误信息
- 支持API Token过期等错误提示

### 3. 简化响应格式

支持直接返回`content`字段的简化响应格式

## API配置示例

### OpenAI API配置

```
api_url: https://api.openai.com/v1/chat/completions
api_key: sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
model: gpt-3.5-turbo
```

### iflow.cn API配置

```
api_url: https://apis.iflow.cn/v1/chat/completions
api_key: sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
model: deepseek-v3.1
```

### 其他平台API配置

根据平台提供的API文档，填写相应的API URL、API密钥和模型名称即可。

## 配置文件

配置信息会自动保存到当前目录的`config.json`文件中，你也可以直接编辑该文件来修改配置。

## 高级功能详解

### 角色预设

角色预设功能允许你一键切换AI的角色，不同角色有不同的说话风格和专业领域：

- **专业文案写手**: 擅长撰写各种类型的文案，包括广告、营销、宣传等
- **严格的教育家**: 严格但公平的教育家，擅长解释复杂概念
- **风趣的聊天伙伴**: 幽默风趣，善于聊天，能制造轻松愉快的氛围
- **编程老师**: 擅长解释编程概念和解决编程问题
- **商业顾问**: 提供专业的商业建议和分析

### 动态人格与情绪模拟

情绪模拟功能允许你调整AI的情绪状态，影响AI的回答语气和风格：

- **中性**: 保持中立的语气，客观回答问题
- **兴奋**: 使用充满活力、积极热情的语气，表达兴奋情绪
- **同情**: 表达理解和温暖关怀，使用同情的语气
- **好奇**: 表达好奇心，使用探索性的语气，鼓励进一步讨论
- **幽默**: 使用风趣幽默的语气，保持轻松愉快的氛围

### 风格模仿

风格模仿功能允许AI模仿你提供的文本风格进行对话：

1. 点击菜单 "预设" -> "风格模仿"
2. 输入要模仿的文本，例如某位作家的文章、你的写作风格等
3. 点击"确定"，AI会分析文本风格并应用到后续对话中

### 反馈学习

反馈学习功能允许你对AI的回答进行反馈，帮助AI改进：

1. 收到AI回答后，使用👍或👎按钮表示满意或不满意
2. 如果点击👎，系统会询问你哪里不好
3. 输入你的反馈，AI会根据反馈调整后续回答

### 审计日志

审计日志功能记录所有用户操作，便于追踪和分析：

- 日志文件位于`logs`目录，按日期命名
- 记录包括操作时间、执行者、操作类型和详情
- 支持的操作包括：发送消息、开始新对话、重新生成回答、清空历史、切换角色预设、切换情绪、风格模仿、点赞、点踩等

### 思维可视化

思维可视化功能实时生成对话思维导图，帮助你理解对话结构：

- 位于右侧下部分，自动生成
- 以层级结构显示，用户消息为一级节点，AI回复为二级节点
- 实时更新，与对话历史保持同步
- 采用Markdown格式，清晰易读

## 故障排除

### 常见问题及解决方案

1. **API调用失败：ConnectionError**
   - 检查网络连接是否正常
   - 检查API URL是否正确
   - 检查防火墙设置，确保允许程序访问网络
   - 部分API服务可能需要科学上网

2. **API返回格式异常**
   - 查看左侧调试信息区域的原始API响应
   - 检查API配置是否正确
   - 确保使用的模型名称与API服务兼容
   - 尝试调整API参数

3. **API请求失败：Your API Token has expired**
   - 前往相应平台重置API Token
   - 更新配置中的API密钥
   - 注意不同平台的API Token有效期可能不同

4. **图形界面无法启动**
   - 检查PyQt6是否正确安装
   - 尝试使用命令行版本
   - 查看控制台输出的错误信息

5. **程序崩溃或无响应**
   - 确保使用的Python版本符合要求（3.7+）
   - 重新安装依赖：`pip install -r requirements.txt --upgrade`
   - 查看控制台输出的错误堆栈信息

### 调试技巧

- 查看左侧调试信息区域的API请求和响应
- 检查配置文件（config.json）中的参数是否正确
- 尝试使用不同的API服务进行测试
- 查看审计日志，了解操作记录

## 开发说明

### 项目结构

```
ai-chat-software/
├── main.py              # 主入口文件
├── ai_chat_cli.py       # 命令行版本
├── ai_chat_pyqt.py      # PyQt图形界面版本
├── conversation_manager.py  # 对话管理模块
├── preset_manager.py    # 预设与模板管理模块
├── config.json          # 主配置文件（自动生成）
├── model_configs.json    # 多模型配置文件（自动生成）
├── requirements.txt     # 依赖配置
├── README.md            # 项目文档
├── conversations/       # 对话历史存储文件夹
├── presets/             # 预设和模板存储文件夹
│   ├── prompts.json     # 角色预设文件
│   └── templates.json   # 对话模板文件（文件已删除）
└── logs/                # 审计日志存储文件夹
```

### 代码结构

- **AIChat类**：核心功能实现，包括API调用、配置管理和对话历史
- **ConversationManager类**：对话管理，处理多个对话、文件夹、标签等
- **PresetManager类**：预设与模板管理，处理角色预设和对话模板
- **图形界面类**：基于PyQt6的界面实现
- **API调用线程**：异步处理API请求，避免阻塞界面
- **配置管理**：加载、保存和验证配置
- **审计日志管理**：记录所有用户操作

### 扩展开发

1. **添加新的API响应格式支持**：
   - 修改`call_api`方法中的响应处理逻辑
   - 添加新的响应格式检查和解析

2. **添加新角色预设**：
   - 在`presets/prompts.json`文件中添加新的角色预设
   - 每个角色预设包括名称、描述和系统提示

3. **添加新功能**：
   - 基于现有的模块化设计添加新功能
   - 注意保持代码的可读性和可维护性

4. **界面定制**：
   - 修改图形界面类的布局和样式
   - 添加新的UI组件

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request，一起改进这个项目！

### 贡献指南

1. Fork本项目
2. 创建新的分支：`git checkout -b feature/your-feature`
3. 提交更改：`git commit -m 'Add some feature'`
4. 推送分支：`git push origin feature/your-feature`
5. 提交Pull Request

## 联系方式

如果您有任何问题或建议，欢迎通过以下方式联系：

- 提交GitHub Issue

## 更新日志

### v2.1.0（2025-12-05）

#### 核心功能增强
- **API模型切换功能**
  - 支持保存和管理多个API服务商配置
  - 左侧新增模型信息显示区域，清晰展示当前使用的模型
  - 支持添加、编辑、删除和切换不同模型配置
  - 每个模型配置包含完整参数：API URL、API Key、模型名称、温度参数和最大Tokens
  - 配置自动保存到`model_configs.json`文件，确保数据持久化
  - 当前模型配置同步保存到`config.json`，保持配置一致性
  - 支持多API服务商快速切换，无需重新配置

#### 用户体验优化
- **消息复制功能**
  - 聊天历史区域支持右键菜单复制选中的消息内容
  - 选中任意文本后，右键即可选择复制选项
  - 复制后状态栏显示成功提示，操作反馈清晰
  - 支持复制单条消息或部分内容，操作灵活

- **对话导出功能**
  - 支持将对话历史导出为Markdown格式，适合文档编写
  - 支持将对话历史导出为TXT格式，适合简单阅读
  - 导出内容包含完整对话历史和导出时间戳
  - 自动生成带时间戳的文件名，便于管理
  - 导出成功后显示消息提示，操作结果明确

- **键盘快捷键支持**
  - 配置：Ctrl+P
  - 新对话：Ctrl+N
  - 清空历史：Ctrl+Shift+L
  - 重新生成回答：Ctrl+R
  - 保存对话：Ctrl+S
  - 退出：Ctrl+Q
  - 增大字体：Ctrl++
  - 减小字体：Ctrl+-  
  - 重置字体：Ctrl+0
  - 全面提升操作效率，适合频繁使用

- **消息搜索功能**
  - 对话历史区域顶部添加搜索栏
  - 支持搜索对话内容，高亮显示所有匹配项
  - 支持跳转到下一个匹配项，方便浏览长对话
  - 支持清除搜索结果，恢复原始显示
  - 搜索结果数量实时显示在状态栏
  - 提升了长对话的内容检索能力

- **字体大小调整功能**
  - 支持通过菜单或快捷键调整聊天历史字体大小
  - 字体大小范围：8px-24px，防止字体过大或过小
  - 支持一键重置字体大小到默认值
  - 状态栏实时显示当前字体大小
  - 提升了不同用户的阅读舒适度

#### 界面与样式改进
- **左侧界面优化**
  - 调试信息区域上方新增模型信息显示框
  - 模型名称以蓝色粗体显示，清晰醒目
  - 提供"切换模型"和"配置模型"快捷按钮
  - 整体布局更加紧凑，信息展示更加清晰
  - 视觉层次分明，便于快速获取关键信息

- **按钮样式优化**
  - 模型切换按钮采用蓝色背景，白色文字，醒目易识别
  - 配置模型按钮采用灰色背景，白色文字，与切换按钮形成区分
  - 按钮添加圆角效果，现代化设计风格
  - 优化了按钮字体粗细和大小，增强可读性
  - 统一了按钮尺寸，保持界面一致性

- **消息框样式优化**
  - 设置了全局消息框样式，确保文字清晰可见
  - 消息框背景为白色，文字为黑色，对比度合适
  - 优化了消息框按钮样式，提升点击体验
  - 确保所有消息框中的文字都清晰可读
  - 提升了整体视觉效果和专业感

#### 技术优化与修复
- **配置保存机制改进**
  - 双文件保存机制：所有模型配置保存到`model_configs.json`，当前模型配置保存到`config.json`
  - 确保配置文件的一致性和完整性
  - 优化了配置加载和保存的错误处理
  - 提升了配置管理的可靠性

- **bug修复**
  - 修复了模型切换对话框中的AttributeError
  - 修复了按钮点击事件处理中的异常
  - 改进了错误提示信息，更加清晰易懂
  - 提升了软件的稳定性和可靠性

#### 文档更新
- 更新了README.md文件，添加了所有新功能的详细说明
- 完善了功能特点部分，明确列出所有功能
- 优化了更新日志，按时间顺序清晰记录版本演进
- 更新了项目结构，添加了新的模型配置文件
- 为用户提供了更好的文档支持和使用指南

### v2.0.0（2025-12-04）

- 新增动态人格与情绪模拟功能
- 新增风格模仿功能
- 新增反馈学习功能
- 新增审计日志功能
- 新增思维可视化功能
- 优化了图形界面布局
- 改进了API调用和错误处理
- 更新了README文档

### v1.0.0（2025-12-02）

- 初始版本发布
- 支持命令行和图形界面
- 支持多种API响应格式
- 完善的错误处理机制
- 详细的文档说明